<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Object Lifecycle Management (‘using’ Clauses)</title>
    <link rel="StyleSheet" href="css/exceptionhandling.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>Gosu Reference Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="exceptionhandling.12.1.html#1457329">Exception Handling</a> : Object Lifecycle Management (‘using’ Clauses)</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="1457329">Object Lifecycle Management (‘using’ Clauses)</a></h3>
      <div class="B_-_Body"><a name="1502047">If you have an object with a lifecycle of a finite extent of code, you can simplify your code with the </a><span class="cv_-_computer_voice">using</span> statement. The <span class="cv_-_computer_voice">using</span> statement is a more compact syntax and less error-prone way to work with resources than using <span class="cv_-_computer_voice">try</span>/<span class="cv_-_computer_voice">catch</span>/<span class="cv_-_computer_voice">finally</span> clauses. With <span class="cv_-_computer_voice">using</span> clauses:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1502054">Cleanup always occurs without requiring a separate </a><span class="cv_-_computer_voice">finally</span> clause.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1502059">You do not need to explicitly check whether variables for initialized resources have </a><span class="cv_-_computer_voice">null</span> values. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1502077">Code for locking and synchronizing resources is easy to use and understand.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1468264">For example, suppose you want to use an output stream. Typical code would open the stream, then use it, then close the stream to dispose of related resources. If something goes wrong while using the output stream, your code must close the output stream and perhaps check whether it successfully opened before closing it. In Gosu (or standard Java), you could use a </a><span class="cv_-_computer_voice">try</span>/<span class="cv_-_computer_voice">finally</span> block like the following to clean up the stream:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457336">OutputStream os = SetupMyOutputStream() // insert your code that creates your output stream</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457337">try {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457338">&nbsp;&nbsp;//do something with the output stream </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457339">} </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457340">&nbsp;&nbsp;finally {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457341">&nbsp;&nbsp;os.close();</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502235">}</a></PRE>
      <div class="B_-_Body"><a name="1502236">You can simplify that code instead using the Gosu </a><span class="cv_-_computer_voice">using</span> statement:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502237">using( var os = SetupMyOutputStream() ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502238">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457346">     //do something with the output stream</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457347">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1457348">} // Gosu disposes of the stream after it completes or if there is an exception</a></PRE>
      <div class="B_-_Body"><a name="1468304">The basic form of a using clause is as follows:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1468305">using( </a><span class="pc_-_parameter_in_code">ASSIGNMENT_OR_LIST_OF_STATEMENTS</span> )</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1468306">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1468149">  // do something here</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1468150">}</a></PRE>
      <div class="B_-_Body"><a name="1468151">The parentheses after the </a><span class="cv_-_computer_voice">using</span> keyword can contain either a Gosu expression or a list of one or more Gosu statements delimited by commas (not semicolons). For more details about using multiple initializable objects, see <a href="javascript:WWHClickedPopup('gosu', 'exceptionhandling.12.5.html#1502467', '');" title="Object Lifecycle Management (‘using’ Clauses)">“Passing Multiple Items to the ‘using’ Statement”</a></div>
      <div class="B_-_Body"><a name="1466690">There are several categories of objects that work with the </a><span class="cv_-_computer_voice">using</span> keyword: <span class="e_-_emphasis">disposable</span> objects, <span class="e_-_emphasis">closeable</span> objects, and <span class="e_-_emphasis">reentrant</span> objects. If you try to use an object that does not satisfy the requirements of one of these categories, Gosu displays a compile error. The following subtopics discuss these three types of objects.</div>
      <div class="B_-_Body"><a name="1468337">If Gosu detects that an object is more than one category, at run time Gosu considers the object only one category, defined by the following precedence: </a><span class="e_-_emphasis">disposable</span>, <span class="e_-_emphasis">closeable</span>, <span class="e_-_emphasis">reentrant</span>. For example, if an object has a <span class="cv_-_computer_voice">dispose</span> and <span class="cv_-_computer_voice">close</span> method, Gosu only calls the <span class="cv_-_computer_voice">dispose</span> method. </div>
      <div class="B_-_Body"><a name="1469477">Return values from </a><span class="cv_-_computer_voice">using</span> clauses using the <span class="cv_-_computer_voice">return</span> statement, discussed further in <a href="javascript:WWHClickedPopup('gosu', 'exceptionhandling.12.5.html#1469250', '');" title="Object Lifecycle Management (‘using’ Clauses)">“Returning Values from ‘using’ Clauses”</a>.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="1502852">Assigning Variables Inside ‘using’ Expression Declaration</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1502853">The </a><span class="cv_-_computer_voice">using</span> clause supports assigning a variable inside the declaration of the <span class="cv_-_computer_voice">using</span> clause. This is useful if the expression that you pass to the <span class="cv_-_computer_voice">using</span> expression is something that you want to reference from inside the <span class="cv_-_computer_voice">using</span> clause</div>
      <div class="B_-_Body"><a name="1502857">For example, suppose you call a method that returns a file handle and you pass that to the </a><span class="cv_-_computer_voice">using</span> clause as the lock. From within the <span class="cv_-_computer_voice">using</span> clause contents, you probably want to access the file so you can iterate across its contents. </div>
      <div class="B_-_Body"><a name="1502858">To simplify this kind of code, assign a variable to the expression using the </a><span class="cv_-_computer_voice">var</span> keyword:</div>
      <PRE class="CF_-_Code_First_Line"><a name="1502859">using ( var </a><span class="pc_-_parameter_in_code">VARIABLE_NAME</span> = <span class="pc_-_parameter_in_code">EXPRESSION</span> ) {</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502860">&nbsp;&nbsp;// code that references the </a><span class="pc_-_parameter_in_code">VARIABLE_NAME</span> variable</PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502861">}</a></PRE>
      <div class="B_-_Body"><a name="1502862">For example:</a></div>
      <PRE class="CF_-_Code_First_Line"><a name="1502863">using( var out = new FileOutputStream( this, false ) ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502864">&nbsp;&nbsp;out.write( content )</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="1502865">}</a></PRE>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="1502467">Passing Multiple Items to the ‘using’ Statement</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1502468">You can pass one or multiple items in the </a><span class="cv_-_computer_voice">using</span> clause expression. You must separate each item by a comma character, not a semicolon character as in a typical Gosu statement list.</div>
      <div class="B_-_Body"><a name="1502469">For example: </a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502470">function useReentrantLockNew() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502471">&nbsp;&nbsp;using( _lock1, _lock2, _lock3) { </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502472">&nbsp;&nbsp;&nbsp;&nbsp;// do your main work here</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502473">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502474">}</a></PRE>
      <div class="B_-_Body"><a name="1502475">You can combine the multiple item feature with the ability to assign variables. For more about assigning variables, see </a><a href="javascript:WWHClickedPopup('gosu', 'exceptionhandling.12.5.html#1502852', '');" title="Object Lifecycle Management (‘using’ Clauses)">“Assigning Variables Inside ‘using’ Expression Declaration”</a>. Gosu runs any statements, including variable assignment, at run time and uses the result as an object to manage in the <span class="cv_-_computer_voice">using</span> clause. Within each comma-delimited assignment statement, you do not need a <span class="cv_-_computer_voice">return</span> statement.</div>
      <div class="B_-_Body"><a name="1502479">For example:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502480">using( var lfc = new FileInputStream(this).Channel,</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502481">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rfc = new FileInputStream(that).Channel ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502482">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502483">      var lbuff  = ByteBuffer.allocate(bufferSize)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502484">      var rbuff  = ByteBuffer.allocate(bufferSize)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502485">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502486">      while (lfc.position() &lt; lfc.size()) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502487">        lfc.read(lbuff)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502488">        rfc.read(rbuff)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502489">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502490">        if (not Arrays.equals(lbuff.array(), rbuff.array())) </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502491">        {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502492">          return true</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502493">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502494">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502495">        lbuff.clear()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502496">        rbuff.clear()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502497">      }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502498">      return false</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1502499">    }</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="1502500">  }</a></PRE>
      <div class="B_-_Body"><a name="1502501">Gosu ensures that all objects are properly cleaned up. Gosu cleans up only the objects that initialized without throwing exceptions or otherwise having errors such as returning </a><span class="cv_-_computer_voice">null</span> for a resource. </div>
      <div class="B_-_Body"><a name="1502502">If you choose to initialize multiple resources and some but not all objects in the list successfully initialize:</a></div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="1502503">Gosu skips initialization for any of the items not yet initialized, in other words the ones that appear later in the initialization list.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="1502504">Gosu skips execution of the main part of the </a><span class="cv_-_computer_voice">using</span> clause.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="1503099">Gosu cleans up exactly the set of objects that initialized without errors. In other words, Gosu releases, closes, or disposes the object, depending on the type of object.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1503100">For example, suppose you try to acquire three resources, and the first one succeeds but the second one fails. Gosu does not attempt to acquire the third resource. Then Gosu cleans up the one resource that did acquire successfully. </a></div>
      <h4 class="H2_-_Heading_2"><a name="1466707">Disposable Objects</a></h4>
      <div class="B_-_Body"><a name="1466719">Disposable objects are objects that Gosu can dispose to release all system resources. For Gosu to recognize a valid disposable object, the object must have one of the following attributes:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1467046">The object implements the Gosu interface </a><span class="cv_-_computer_voice">IDisposable</span>. This interface contains only a single method called <span class="cv_-_computer_voice">dispose</span>. This method takes no arguments. Always use a type that implements <span class="cv_-_computer_voice">IDisposable</span> if possible due to faster run time performance.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1467127">The object has a </a><span class="cv_-_computer_voice">dispose</span> method even if it does not implement the <span class="cv_-_computer_voice">IDisposable</span> interface. This approach works but is slower at run time because Gosu must use reflection (examining the type at run time) to find the method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1467128">A type’s </a><span class="cv_-_computer_voice">dispose</span> method must release all the resources that it owns. The <span class="cv_-_computer_voice">dispose</span> method must release all resources owned by its base types by calling its parent type’s <span class="cv_-_computer_voice">dispose</span> method. </div>
      <div class="B_-_Body"><a name="1467181">To help ensure that resources clean up appropriately even under error conditions, you must design your </a><span class="cv_-_computer_voice">dispose</span> method such that Gosu can call it multiple times without throwing an exception. In other words, if the stream is already closed, then invoking this method has no effect nor throw an exception. </div>
      <h4 class="H2_-_Heading_2"><a name="1466986">Closeable Objects and ‘using’ Clauses</a></h4>
      <div class="B_-_Body"><a name="1467000">Closeable objects include objects such as data streams, reader or writer objects, and data channels. Many of the objects in the package </a><span class="cv_-_computer_voice">java.io</span> are closeable objects. For Gosu to recognize a valid closeable object, the object must have one of the following attributes:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1467221">Implements the Java interface </a><span class="cv_-_computer_voice">java.io.ICloseable</span>, which contains only a single method called <span class="cv_-_computer_voice">close</span>. This method takes no arguments. Use a type that implements <span class="cv_-_computer_voice">ICloseable</span> if possible due to faster run time performance.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1467253">Has a </a><span class="cv_-_computer_voice">close</span> method even if it does not implement the <span class="cv_-_computer_voice">ICloseable</span> interface. This approach works but is slower at run time because Gosu must use reflection (examining the type at run time) to find the method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1467302">A type’s </a><span class="cv_-_computer_voice">close</span> method must release all the resources that it owns. The <span class="cv_-_computer_voice">close</span> method must release all resources owned by its base types by calling its parent type’s <span class="cv_-_computer_voice">close</span> method. </div>
      <div class="B_-_Body"><a name="1467303">To help ensure that resources clean up appropriately even under error conditions, you must design your </a><span class="cv_-_computer_voice">close</span> method such that Gosu can call it multiple times without throwing an exception. In other words, if the object is already closed, then invoking this method must have no effect nor throw an exception. </div>
      <div class="B_-_Body"><a name="1467836">The following example creates a new Java file writer instance (</a><span class="cv_-_computer_voice">java.io.FileWriter</span>) and uses the more verbose <span class="cv_-_computer_voice">try</span> and <span class="cv_-_computer_voice">finally</span> clauses:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467860">var writer = new FileWriter( "c:\\temp\\test1.txt" )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467861">try</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467862">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467863">  writer.write( "I am text within a file." )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467864">}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467865">finally</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467866">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467867">  if( writer != null )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467868">  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467869">    writer.close()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467870">  }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467871">}</a></PRE>
      <div class="B_-_Body"><a name="1467872">In contrast, you can write more readable Gosu code using the </a><span class="cv_-_computer_voice">using</span> keyword:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467873">using( var writer = new FileWriter( "c:\\temp\\test1.txt" ) )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467874">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467875">  writer.write( "I am text within a file." )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467876">}</a></PRE>
      <div class="B_-_Body"><a name="1467877">You can list multiple </a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467878">using( var reader = new FileReader( "c:\\temp\\usingfun.txt" ),</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467879">       var writer = new FileWriter( "c:\\temp\\usingfun2.txt" ) )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467880">{</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467881">  writer.write( StreamUtil.getContent( reader ) )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1467849">}</a></PRE>
      <h6 class="HS_-_Head_Sub"><a name="1469344">JDBC Resources and Using Clauses</a></h6>
      <div class="B_-_Body"><a name="1469345">The following example shows how to use a using clause with a JDBC (Java Database Connection) object.</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469346">uses java.sql.*</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469387">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469401">...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469394">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469369">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469380">function sampleJdbc( con : Connection )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469347">  {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469348">    using( var stmt = con.createStatement(),</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469349">           var rs = stmt.executeQuery( "SELECT a, b FROM TABLE2" ) )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469350">    {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469351">      rs.moveToInsertRow()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469352">      rs.updateString( 1, "AINSWORTH" )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469353">      rs.insertRow()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469354">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469355">  }</a></PRE>
      <h4 class="H2_-_Heading_2"><a name="1457358">Reentrant Objects and ‘using’ Clauses</a></h4>
      <div class="B_-_Body"><a name="1507233">Re-entrant objects are objects that help manage safe access to data that is shared by re-entrant or concurrent code execution. For example, if you must store data that is shared by multiple threads, ensure that you protect against concurrent access from multiple threads to prevent data corruption. The most prominent type of shared data is class </a><span class="e_-_emphasis">static variables</span>, which are variables that are stored on the Gosu class itself.</div>
      <div class="B_-_Body"><a name="1507235">For Gosu to recognize a valid reentrant object, the object must have one of the following attributes:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1507236">Implements the </a><span class="cv_-_computer_voice">java.util.concurrent.locks.Lock</span> interface. This includes the Java classes in that package: <span class="cv_-_computer_voice">ReentrantLock</span>, <span class="cv_-_computer_voice">ReadWriteLock</span>, <span class="cv_-_computer_voice">Condition</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1507237">You cast the object to the Gosu interface </a><span class="cv_-_computer_voice">IMonitorLock</span>. You can cast <span class="s_-_strong">any</span> arbitrary object to <span class="cv_-_computer_voice">IMonitorLock</span>. It is useful to cast Java monitor locks to this Gosu interface. For more information on this concept, refer to:</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="CS_-_Code_Single_Line"><a name="1507238">http://en.wikipedia.org/wiki/Monitor_(synchronization)</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1507239">Implements the Gosu class </a><span class="cv_-_computer_voice">gw.lang.IReentrant</span>. This interface contains two methods with no arguments: <span class="cv_-_computer_voice">enter</span> and <span class="cv_-_computer_voice">exit</span>. Your code must properly lock or synchronize data access as appropriate during the <span class="cv_-_computer_voice">enter</span> method and release any locks in the <span class="cv_-_computer_voice">exit</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1507240">For blocks of code using locks (code that implements </a><span class="cv_-_computer_voice">java.util.concurrent.locks.Lock</span>), a <span class="cv_-_computer_voice">using</span> clause simplifies your code. </div>
      <div class="B_-_Body"><a name="1507241">The following code uses the </a><span class="cv_-_computer_voice">java.util.concurrent.locks.ReentrantLock</span> class using a longer (non-recommended) form:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507242">// in your class variable definitions...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507243">var _lock : ReentrantLock = new ReentrantLock()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507244">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507245">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507246">function useReentrantLockOld() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507247">&nbsp;&nbsp;_lock.lock()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507248">&nbsp;&nbsp;try { </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507249">      // do your main work here</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507250">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507251">&nbsp;&nbsp;finally {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507252">&nbsp;&nbsp;&nbsp;&nbsp;_lock.unlock()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507253">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507254">}</a></PRE>
      <div class="B_-_Body"><a name="1507255">In contrast, you can write more readable Gosu code using the </a><span class="cv_-_computer_voice">using</span> keyword:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507256">// in your class variable definitions...</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507257">var _lock : ReentrantLock = new ReentrantLock()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507258">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507259">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507260">function useReentrantLockNew() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507261">&nbsp;&nbsp;using( _lock ) { </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507262">&nbsp;&nbsp;&nbsp;&nbsp;// do your main work here</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507263">&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507264">}</a></PRE>
      <div class="B_-_Body"><a name="1507265">Similarly, you can cast any object to a monitor lock by adding “</a><span class="cv_-_computer_voice">as&nbsp;IMonitorLock</span>” after the object. For example, the following method call code uses itself (using the special keyword <span class="cv_-_computer_voice">this</span>) as the monitor lock:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507266">function monitorLock() {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507267">&nbsp;&nbsp;using( this as IMonitorLock ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507268">      // do stuff</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507269">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1507270">  }</a></PRE>
      <div class="B_-_Body"><a name="1507272">This approach effectively is equivalent to a </a><span class="cv_-_computer_voice">synchronized</span> block in the Java language.</div>
      <div class="B_-_Body"><a name="1469829">There is much more information about concurrency APIs in the section </a><a href="javascript:WWHClickedPopup('gosu', 'concurrency.29.1.html#1441309', '');" title="Concurrency">“Concurrency”</a>.</div>
      <h4 class="H2_-_Heading_2"><a name="1469250">Returning Values from ‘using’ Clauses</a></h4>
      <div class="B_-_Body"><a name="1469570">You can return values from within </a><span class="cv_-_computer_voice">using</span> clauses using the standard <span class="cv_-_computer_voice">return</span> statement. If you return a value from within a using clause, Gosu considers the clause complete so it calls your object’s final lifecycle management method to clean up your resources:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1501737">For disposable objects, Gosu calls the </a><span class="cv_-_computer_voice">dispose</span> method</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1501777">For closable objects, Gosu calls the </a><span class="cv_-_computer_voice">close</span> method</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="1501824">For a reentrant or lock object, Gosu calls the </a><span class="cv_-_computer_voice">exit</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="1501905">See previous topics for more information about each type of object you can use with a </a><span class="cv_-_computer_voice">using</span> clause.</div>
      <div class="B_-_Body"><a name="1502019">The following Gosu example opens a file using the Java </a><span class="cv_-_computer_voice">BufferedReader</span> class and reads lines from the file until the line matches a regular expression. If code in the <span class="cv_-_computer_voice">while</span> loop finds a match, it immediately returns the value and skips the rest of the code within the <span class="cv_-_computer_voice">using</span> clause. </div>
      <PRE class="CF_-_Code_First_Line"><a name="1502020">uses java.io.File</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1474308">uses java.io.BufferedReader</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1474309">uses java.io.FileReader</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469594">&nbsp;</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469605">function containsText( file : File, regExp : String ) : boolean {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469253">    using( var reader = new BufferedReader( new FileReader( file ) ) ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469255">      var line = reader.readLine()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469256">      while( line != null ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469258">        if( line.matches( regExp ) ) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469260">          return true</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1474247">        }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1474255">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line = reader.readLine() // read the next line</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1474248">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1474249">    }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469264">    return false</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="1469265">  }</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="1469267">}</a></PRE>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>